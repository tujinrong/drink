@{
    Layout = "";
}

<!--[if IE 9]>

<link rel="stylesheet" href="/SMAT.UI/Styles/bootstrap.css" type="text/css" />

<link rel="stylesheet" href="/SMAT.UI/Styles/asmat.common.animate.css" type="text/css" />
<link rel="stylesheet" href="/SMAT.UI/Styles/asmat.common.icon.css" type="text/css" />
<link rel="stylesheet" href="/SMAT.UI/Styles/asmat.common-material.min.css" type="text/css">
<link rel="stylesheet" href="/SMAT.UI/Styles/asmat.material.min.css" type="text/css">

<link rel="stylesheet" href="/SMAT.UI/Styles/asmat.app.css" type="text/css" />

<script src="/SMAT.UI/Scripts/jquery.min.js"></script>
<script src="/SMAT.UI/Scripts/jquery.ba-throttle-debounce.min.js"></script>
    <script src="/SMAT.UI/Scripts/js/jquery.linq.min.js"></script>

<script src="/SMAT.UI/Scripts/js/bootstrap.js"></script>

<script src="/SMAT.UI/Scripts/js/asmat.app.js"></script>
<script src="/SMAT.UI/Scripts/js/slimscroll/jquery.slimscroll.min.js"></script>
<script src="/SMAT.UI/Scripts/js/asmat.app.plugin.js"></script>

<script src="/SMAT.UI/Scripts/asmat.all.min.js"></script>
<script src="/SMAT.UI/Scripts/smat.core.js"></script>
<script src="/SMAT.UI/Scripts/smat.service.js"></script>
<script src="/SMAT.UI/Scripts/smat.ui.js"></script>
<script src="/SMAT.UI/Scripts/smat.ui.Button.js"></script>
<script src="/SMAT.UI/Scripts/smat.ui.DatePicker.js"></script>
<script src="/SMAT.UI/Scripts/smat.ui.DateTimePicker.js"></script>
<script src="/SMAT.UI/Scripts/smat.ui.DropDownList.js"></script>
<script src="/SMAT.UI/Scripts/smat.ui.Form.js"></script>
<script src="/SMAT.UI/Scripts/smat.ui.Grid.js"></script>
<script src="/SMAT.UI/Scripts/smat.ui.NumericTextBox.js"></script>
<script src="/SMAT.UI/Scripts/smat.ui.Refer.js"></script>
<script src="/SMAT.UI/Scripts/smat.ui.RadioButton.js"></script>
<script src="/SMAT.UI/Scripts/smat.ui.Pager.js"></script>
<script src="/SMAT.UI/Scripts/smat.ui.TextBox.js"></script>
<script src="/SMAT.UI/Scripts/cultures/smat.culture.ja.min.js"></script>
<script src="/Scripts/smat.config.js"></script>

<script src="/SMAT.UI/Scripts/dynamics/smat.dynamics.js"></script>
<script src="/SMAT.UI/Scripts/dynamics/template/smat.dynamics.template.js"></script>
<script src="/SMAT.UI/Scripts/dynamics/template/smat.dynamics.template.SimpleSearch.js"></script>
<script src="/SMAT.UI/Scripts/dynamics/smat.dynamics.formList.js"></script>
<script src="/SMAT.UI/Scripts/dynamics/smat.dynamics.designer.js"></script>
<script src="/SMAT.UI/Scripts/dynamics/smat.dynamics.tools.js"></script>
<script src="/SMAT.UI/Scripts/dynamics/smat.dynamics.tools.editer.js"></script>
<script src="/SMAT.UI/Scripts/dynamics/smat.dynamics.controls.js"></script>
<script src="/SMAT.UI/Scripts/dynamics/smat.dynamics.controls.Page.js"></script>
<script src="/SMAT.UI/Scripts/dynamics/smat.dynamics.controls.Section.js"></script>
<script src="/SMAT.UI/Scripts/dynamics/smat.dynamics.controls.Form.js"></script>
<script src="/SMAT.UI/Scripts/dynamics/smat.dynamics.controls.Field.js"></script>
<script src="/SMAT.UI/Scripts/dynamics/smat.dynamics.controls.ToolBar.js"></script>
<script src="/SMAT.UI/Scripts/dynamics/smat.dynamics.controls.Button.js"></script>
<script src="/SMAT.UI/Scripts/dynamics/smat.dynamics.controls.Grid.js"></script>
<script src="/SMAT.UI/Scripts/dynamics/smat.dynamics.controls.Line.js"></script>
<script src="/SMAT.UI/Scripts/dynamics/smat.dynamics.controls.Pager.js"></script>
<link rel="stylesheet" href="/Content/Site.css" type="text/css" />
<style>
    .s-icon {
        margin-top:11px;
    }
</style>
<![endif]-->

<script>
    function onAfterStopTypeChange() {
        $("#txtAfterDate").ui().enable($("#rdoAfterStopType").ui().value() == "2");
        if ($("#rdoAfterStopType").ui().value() != "2") {
            $("#txtAfterDate").ui().value("");
        } else {
            var tomorrow = new Date();
            tomorrow = tomorrow.valueOf();
            tomorrow = tomorrow + 1 * 24 * 60 * 60 * 1000;
            tomorrow = new Date(tomorrow);
            $("#txtAfterDate").ui().value(tomorrow);
        }
    }

    //画面閉じる
    function closeAfterStopEditFormForm() {
        smat.service.closeForm({
            contentId: "afterStopEditForm",//フォームＩＤ
            result: {}//処理結果
        });

        
    }

    function getParamAfterStopEditFormForm(param) {
        param.AfterDate = $("#txtAfterDate").ui().value();

    }

    function afterStopEditSuccess() {
        closeAfterStopEditFormForm();
    }

    function checkAfterStopEditForm() {
        if ($("#rdoAfterStopType").ui().value() == "2") {
            if ($("#txtAfterDate").ui().value() == null || $("#txtAfterDate").ui().value() == "") {
                smat.service.addErrorInfo("txtAfterDate", $("#txtAfterDate"), "【後日フォロー日】を入力してください。");
                return false;
            }

            if (Number(asmat.toString($("#txtAfterDate").ui().value(), "yyyyMMdd")) >= Number(asmat.toString(new Date("@ViewBag.NextHoDate"), "yyyyMMdd"))
                || Number(asmat.toString($("#txtAfterDate").ui().value(), "yyyyMMdd")) <= Number(asmat.toString(new Date(), "yyyyMMdd"))) {

                var fromDate = new Date();
                fromDate = fromDate.valueOf();
                fromDate = fromDate + 1 * 24 * 60 * 60 * 1000;
                fromDate = new Date(fromDate);

                var toDate = new Date("@ViewBag.NextHoDate");
                toDate = toDate.valueOf();
                toDate = toDate + (-1) * 24 * 60 * 60 * 1000;
                toDate = new Date(toDate);

                if (fromDate.valueOf() > toDate.valueOf()) {
                    smat.service.addErrorInfo("txtAfterDate", $("#txtAfterDate"), "次回日を超える後日フォローは指定できませんので今ストを指定してください。");

                } else {
                    smat.service.addErrorInfo("txtAfterDate", $("#txtAfterDate"), "後日フォロー日は【" + asmat.toString(fromDate, "yyyy/MM/dd") + "】～【" + asmat.toString(toDate, "yyyy/MM/dd") + "】期間内に設定してください。");

                }
                return false;
            }
        }
        return true;
    }
</script>

<section class="scrollable wrapper" style="padding: 0 0 0 5px;max-height: 500px;min-height: 200px;">
    <section class="panel panel-default">
       @using (Html.Smat().BeginForm("afterStopEditForm", new { @class = "panel-body", style = "padding:5px 20px" }
            ).Actions(actions =>
                {
                    actions.Action("/DeliveryRoute/SaveAfterStop")
                        .ActionBtn("afterStopBtnSave")
                        .GetParam("getParamAfterStopEditFormForm")
                        .CheckForm("checkAfterStopEditForm")
                        .Success("afterStopEditSuccess");
                }
            ))
        {
            @Html.Hidden("ShopCD", ViewBag.ShopCD as string);
            @Html.Hidden("ClientCD", ViewBag.ClientCD as string);
            @Html.Hidden("HoDate", ViewBag.HoDate as string);
            @Html.Hidden("Route", ViewBag.Route as string);
            @Html.Hidden("StaffCD", ViewBag.StaffCD as string);
            @Html.Hidden("Seq", ViewBag.Seq as string);
            @Html.Hidden("FirstFlag", ViewBag.FirstFlag as string);

    <div class="form-horizontal" id="afterStopTypeBox">
        <div class="row ">
            <div class="col-fix-1" style="width:160px;">
                @(Html.Smat().RadioButton("rdoAfterStopType")
                                                .Name("AfterStopFlag")
                                                .DataSource(new List<object>() {
                                                            new{text="変消",value="0"},
                                                            new{text="今スト",value="1"},
                                                            new{text="後日フォロー",value="2"}
                                                }).HtmlAttributes(new { style = "width:100px;" })
                                                .Value(ViewBag.AfterStopFlag as string)
                                                .Events(events =>
                                                {
                                                    events.Change("onAfterStopTypeChange");
                                                })
                                                .Enable(false)
                )
            </div>
        </div>

        <div class="row ">
            <div class="col-fix-1" style="width:160px;margin-left: 45px;">
                @Html.Smat().DatePicker("txtAfterDate").Name("AfterDate").Value(ViewBag.AfterDate as DateTime?).HtmlAttributes(new { @class = " input-s-date" })
            </div>
        </div>
    </div>
        }

        <div class="row  text-center">


            @(Html.Smat().Button("afterStopBtnSave")
                                            .Content("OK")
                                .HtmlAttributes(new { @class = "btn-primary" })
            )

            @(Html.Smat().Button("afterStopClose")
                                            .Content("ｷｬﾝｾﾙ")
                                .HtmlAttributes(new { @class = "btn-primary" })
                                .Events(events =>
                                {
                                    events.Click("closeAfterStopEditFormForm");//画面閉じる
                                })
            )
        </div>
    </section>
    <script>
        $(document).ready(function () {
            $("#txtAfterDate").ui().enable($("#rdoAfterStopType").ui().value() == "2");

            if ($("#rdoAfterStopType").ui().value() != "2") {
                $("#txtAfterDate").ui().value("");
            }

            if ($("#rdoAfterStopType").ui().value() == "0") {
                $("#afterStopTypeBox input[type='radio'][value='1']").click();
                $("#afterStopTypeBox input[type='radio'][value='0']").closest('label').hide();
            }

            if (mainRoleCD == mainCN役割_本部参照) {
                $("#afterStopBtnSave").remove();
            }
        });
    </script>
</section>